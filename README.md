# Auto Webhook Flutter - ููุฏูู ุชุชุจุน ุงูุชุบููุฑุงุช ุงูุชููุงุฆู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ููุฏูู Odoo 18 ูุชุณุฌูู ุชููุงุฆู ูุฌููุน ุงูุชุบููุฑุงุช ุงูุชู ุชุญุฏุซ ุนูู ุงูููุงุฐุฌ ุงููุญุฏุฏุฉ ูู ุงููุธุงู. ูุณุฌู ุงูููุฏูู ุซูุงุซุฉ ุฃููุงุน ูู ุงูุฃุญุฏุงุซ: **ุฅูุดุงุก**ุ **ุชุนุฏูู**ุ ู**ุญุฐู** ุงูุณุฌูุงุช.

---

## ๐ฏ ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

### 1. ุชุณุฌูู ุชููุงุฆู ููุฃุญุฏุงุซ
- โ **Create (ุฅูุดุงุก)**: ุนูุฏ ุฅูุดุงุก ุณุฌู ุฌุฏูุฏ
- โ๏ธ **Write (ุชุนุฏูู)**: ุนูุฏ ุชุนุฏูู ุณุฌู ููุฌูุฏ
- ๐๏ธ **Unlink (ุญุฐู)**: ุนูุฏ ุญุฐู ุณุฌู

### 2. ููุน ุงูุชูุฑุงุฑ
- ูููุน ุชุณุฌูู ููุณ ุงูุญุฏุซ ูุฑุชูู ูููุณ ุงูุณุฌู
- ูุญุฐู ุฃุญุฏุงุซ Write ุงููุฏููุฉ ุนูุฏ ุฅูุดุงุก ุณุฌู ุฌุฏูุฏ (Create)

### 3. ุฅุฏุงุฑุฉ ุงูุฃุฎุทุงุก
- ูุณุฌู ุฌููุน ุงูุฃุฎุทุงุก ูู ุฌุฏูู ูููุตู (`webhook.errors`)
- ูููุน ุชููู ุงููุธุงู ุนูุฏ ุญุฏูุซ ุฎุทุฃ

### 4. ุชูุธูู ุชููุงุฆู
- ูุธููุฉ Cron ูุชูุธูู ุงูุณุฌูุงุช ุงููุญุฐููุฉ (Orphaned Records)

---

## ๐ ุงูููุงุฐุฌ ุงูููุชุชุจุนุฉ (10 ููุงุฐุฌ)

ุงูููุฏูู ูุชุชุจุน ุงูุชุบููุฑุงุช ูู **10 ููุงุฐุฌ** ูู Odoo:

| # | ุงููููุฐุฌ | ุงููุตู | ุงูุญุงูุฉ |
|---|---------|-------|--------|
| 1 | `sale.order` | ุทูุจุงุช ุงููุจูุนุงุช | โ ููุนู |
| 2 | `product.template` | ููุงูุจ ุงูููุชุฌุงุช | โ ููุนู |
| 3 | `product.category` | ูุฆุงุช ุงูููุชุฌุงุช | โ ููุนู |
| 4 | `res.partner` | ุงูุนููุงุก ูุงูููุฑุฏูู | โ ููุนู |
| 5 | `account.move` | ุงูููุงุชูุฑ ูุงููููุฏ | โ ููุนู |
| 6 | `account.journal` | ุฏูุงุชุฑ ุงูููููุฉ | โ ููุนู |
| 7 | `hr.expense` | ูุตุฑููุงุช ุงูููุธููู | โ ููุนู |
| 8 | `stock.picking` | ุนูููุงุช ุงูููู | โ ููุนู |
| 9 | `purchase.order` | ุทูุจุงุช ุงูุดุฑุงุก | โ ููุนู |
| 10 | `hr.employee` | ุงูููุธููู | โ ููุนู |

**ููุงุญุธุฉ**: ุงููููุฐุฌ `product.product` ููุฌูุฏ ูู ุงูููุฏ ูููู **ูุนุทู** (ูุนูู).

---

## ๐ง ููู ูุนูู ุงูููุฏููุ

### 1. ุขููุฉ ุงูุนูู (WebhookMixin)

ุงูููุฏูู ูุณุชุฎุฏู **Abstract Model** ุงุณูู `webhook.mixin` ูููู ุจู:

```python
class WebhookMixin(models.AbstractModel):
    _name = 'webhook.mixin'
    
    # ูุฑุงูุจ create, write, unlink
    def create(self, vals_list):
        # ูููุฐ ุงูุนูููุฉ ุงูุฃุตููุฉ
        records = super().create(vals_list)
        # ูุณุฌู ุงูุญุฏุซ
        records._log_webhook_event("create")
        return records
```

### 2. ุนูููุฉ ุงูุชุณุฌูู

ุนูุฏ ุญุฏูุซ ุฃู ุชุบููุฑ:

1. **ุงููุดู**: ูุชู ุงูุชุดุงู ุงูุญุฏุซ (create/write/unlink)
2. **ุงูุชุณุฌูู**: ูุชู ุฅูุดุงุก ุณุฌู ูู ุฌุฏูู `update.webhook` ูุญุชูู ุนูู:
   - `model`: ุงุณู ุงููููุฐุฌ (ูุซู: `sale.order`)
   - `record_id`: ุฑูู ุงูุณุฌู
   - `event`: ููุน ุงูุญุฏุซ (create/write/unlink)
   - `timestamp`: ููุช ุงูุญุฏุซ
3. **ุงูุชุญูู**: ูุชู ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุชูุฑุงุฑ
4. **ุงูุชูุธูู**: ูุชู ุญุฐู ุงูุฃุญุฏุงุซ ุงููุฏููุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ

### 3. ูุซุงู ุนูู ุงูุชุณุฌูู

ุนูุฏ ุฅูุดุงุก ุทูุจ ูุจูุนุงุช ุฌุฏูุฏ:

```python
# ูุชู ุฅูุดุงุก ุงูุณุฌู ูู update.webhook:
{
    'model': 'sale.order',
    'record_id': 123,
    'event': 'create',
    'timestamp': '2025-11-15 10:30:00'
}
```

ุนูุฏ ุชุนุฏูู ููุณ ุงูุทูุจ:

```python
{
    'model': 'sale.order',
    'record_id': 123,
    'event': 'write',
    'timestamp': '2025-11-15 11:00:00'
}
```

---

## ๐ ูููู ุงูููุฏูู

```
auto_webhook/
โโโ __init__.py
โโโ __manifest__.py
โโโ models/
โ   โโโ __init__.py
โ   โโโ webhook.py          # WebhookMixin (ุงูููุจ ุงููุงุจุถ)
โ   โโโ list_model.py       # ุงูููุงุฐุฌ ุงูููุชุชุจุนุฉ (10 ููุงุฐุฌ)
โ   โโโ update.py           # update.webhook, webhook.errors, webhook.cleanup.cron
โโโ security/
โ   โโโ ir.model.access.csv
โโโ views/
    โโโ update_webhook_views.xml
    โโโ webhook_menuitem.xml
```

---

## ๐๏ธ ุงูุฌุฏุงูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1. `update_webhook`
ุฌุฏูู ุฑุฆูุณู ูุชุฎุฒูู ุฌููุน ุงูุฃุญุฏุงุซ:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|-------|
| `model` | Char | ุงุณู ุงููููุฐุฌ |
| `record_id` | Integer | ุฑูู ุงูุณุฌู |
| `event` | Selection | ููุน ุงูุญุฏุซ (create/write/unlink) |
| `timestamp` | Datetime | ููุช ุงูุญุฏุซ |

**ููุฏ ูุฑูุฏ**: `unique(model, record_id, event)` - ูููุน ุงูุชูุฑุงุฑ

### 2. `webhook_errors`
ุฌุฏูู ูุชุณุฌูู ุงูุฃุฎุทุงุก:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|-------|
| `model` | Char | ุงุณู ุงููููุฐุฌ |
| `record_id` | Integer | ุฑูู ุงูุณุฌู |
| `error_message` | Text | ุฑุณุงูุฉ ุงูุฎุทุฃ |
| `timestamp` | Datetime | ููุช ุงูุฎุทุฃ |

### 3. `webhook_cleanup_cron`
ุฌุฏูู ูุฅุฏุงุฑุฉ ูุธููุฉ ุงูุชูุธูู ุงูุชููุงุฆู

### 4. `ir_act_server_webhook_field_rel`
ุฌุฏูู ุนูุงูุฉ ุฏุงุฎูู

---

## ๐ ุฅุญุตุงุฆูุงุช ุงูููุฏูู

- **ุนุฏุฏ ุงูููุงุฐุฌ ุงูููุชุชุจุนุฉ**: 10 ููุงุฐุฌ
- **ุฃููุงุน ุงูุฃุญุฏุงุซ**: 3 (create, write, unlink)
- **ุงูุฌุฏุงูู ุงููููุดุฃุฉ**: 4 ุฌุฏุงูู
- **ุงููุงุฌูุงุช**: 2 (List View, Form View)
- **ุงูููุงุฆู**: 2 (ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ + ุงููุงุฆูุฉ ุงููุฑุนูุฉ)

---

## ๐ ุงูุงุณุชุฎุฏุงู

### 1. ุงููุตูู ุฅูู ุงูุณุฌูุงุช

ูู ูุงุฌูุฉ Odoo:
- **ุงููุงุฆูุฉ**: Webhooks โ Webhook Updates
- ููููู ุนุฑุถ ุฌููุน ุงูุฃุญุฏุงุซ ุงูููุณุฌูุฉ
- ููููู ุงูุจุญุซ ูุงูุชุตููุฉ ุญุณุจ:
  - ุงููููุฐุฌ (Model)
  - ููุน ุงูุญุฏุซ (Event)
  - ุงูุชุงุฑูุฎ (Timestamp)

### 2. ุนุฑุถ ุงูุณุฌูุงุช

```
Webhooks โ Webhook Updates
```

ุณุชุฌุฏ ูุงุฆูุฉ ุจุฌููุน ุงูุฃุญุฏุงุซ:
- Model: sale.order
- Record ID: 123
- Event: create
- Timestamp: 2025-11-15 10:30:00

### 3. ุฅุถุงูุฉ ููุงุฐุฌ ุฌุฏูุฏุฉ

ูุฅุถุงูุฉ ูููุฐุฌ ุฌุฏูุฏ ููุชุชุจุน:

1. ุงูุชุญ `/opt/odoo18/custom_models/auto_webhook/models/list_model.py`
2. ุฃุถู ุงูููุงุณ ุงูุฌุฏูุฏ:

```python
class YourModel(models.Model):
    _name = 'your.model'
    _inherit = ['your.model', 'webhook.mixin']
```

3. ุฃุนุฏ ุชุดุบูู Odoo ุฃู ุญุฏุซ ุงูููุฏูู:
```bash
sudo -u odoo18 bash -c "cd /opt/odoo18 && source venv/bin/activate && python3 odoo/odoo-bin -c /etc/odoo18.conf -d your_db -u auto_webhook --stop-after-init --no-http"
```

---

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช ูุงูุตูุงุญูุงุช

### ุงูุตูุงุญูุงุช
- **base.group_user**: ุฌููุน ุงููุณุชุฎุฏููู ูููููู:
  - โ ูุฑุงุกุฉ ุงูุณุฌูุงุช (perm_read)
  - โ ุญุฐู ุงูุณุฌูุงุช (perm_unlink)
  - โ ูุง ูููููู ุฅูุดุงุก ุฃู ุชุนุฏูู (perm_write=0, perm_create=0)

### ุงูุฃูุงู
- ุฌููุน ุงูุณุฌูุงุช ูุชู ุฅูุดุงุคูุง ุจุงุณุชุฎุฏุงู `sudo()` ูุถูุงู ุนุฏู ูุฌูุฏ ูุดุงูู ูู ุงูุตูุงุญูุงุช

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุชุชุจุน ุทูุจ ูุจูุนุงุช

```python
# ุนูุฏ ุฅูุดุงุก ุทูุจ ูุจูุนุงุช ุฌุฏูุฏ
sale_order = self.env['sale.order'].create({
    'partner_id': 1,
    'order_line': [(0, 0, {'product_id': 1, 'product_uom_qty': 10})]
})

# ูุชู ุชุณุฌูู:
# update.webhook: model='sale.order', record_id=123, event='create'
```

### ูุซุงู 2: ุชุชุจุน ุชุนุฏูู ููุชุฌ

```python
# ุนูุฏ ุชุนุฏูู ููุชุฌ
product = self.env['product.template'].browse(1)
product.write({'name': 'ุงุณู ุฌุฏูุฏ'})

# ูุชู ุชุณุฌูู:
# update.webhook: model='product.template', record_id=1, event='write'
```

### ูุซุงู 3: ุชุชุจุน ุญุฐู ุนููู

```python
# ุนูุฏ ุญุฐู ุนููู
partner = self.env['res.partner'].browse(1)
partner.unlink()

# ูุชู ุชุณุฌูู:
# update.webhook: model='res.partner', record_id=1, event='unlink'
```

---

## ๐๏ธ ุงูุตูุงูุฉ ูุงูุชูุธูู

### ุชูุธูู ุงูุณุฌูุงุช ุงููุญุฐููุฉ

ุงูููุฏูู ูุญุชูู ุนูู ูุธููุฉ Cron ูุชูุธูู ุงูุณุฌูุงุช ุงูุชู ุชุดูุฑ ุฅูู ุณุฌูุงุช ูุญุฐููุฉ:

```python
# ูุชู ุงุณุชุฏุนุงุคูุง ุชููุงุฆูุงู
webhook.cleanup.cron โ clean_webhook_records()
```

### ุชูุธูู ูุฏูู

ููููู ุญุฐู ุงูุณุฌูุงุช ุงููุฏููุฉ ูุฏููุงู ูู ูุงุฌูุฉ Odoo:
- Webhooks โ Webhook Updates
- ุงุฎุชุฑ ุงูุณุฌูุงุช ุงููุฑุงุฏ ุญุฐููุง
- ุงุถุบุท Delete

---

## ๐ ุงูุณุฌูุงุช (Logs)

ุงูููุฏูู ูุณุฌู ุฌููุน ุงูุนูููุงุช ูู ุณุฌูุงุช Odoo:

```
๐ก WebhookMixin: Logging create for sale.order
โ Webhook event logged: {'model': 'sale.order', 'record_id': 123, 'event': 'create'}
โ๏ธ Skipping duplicate webhook for model=sale.order record_id=123 event=create
๐๏ธ Removed orphaned webhook record_id 123 from sale.order
โ Error logging webhook event: ...
```

---

## ๐ ุงูุชูุงูู ูุน FastAPI

ูุฐุง ุงูููุฏูู ูุตูู ููุนูู ูุน ุฎุงุฏู FastAPI ุฎุงุฑุฌู:

1. **Odoo**: ูุณุฌู ุงูุฃุญุฏุงุซ ูู `update.webhook`
2. **FastAPI**: ููุฑุฃ ูู `update.webhook` ููุฑุณู Webhooks ููุฃูุธูุฉ ุงูุฎุงุฑุฌูุฉ
3. **Flutter App**: ูุณุชูุจู ุงูุชุญุฏูุซุงุช ูู FastAPI

---

## ๐ฆ ุงููุชุทูุจุงุช

- Odoo 18.0 Community Edition
- Python 3.10+
- PostgreSQL 12+

### ุงูููุฏููุงุช ุงููุทููุจุฉ (Dependencies)
- `base`
- `sale`
- `product`
- `account`
- `purchase`
- `stock`
- `hr_expense`
- `hr`

---

## ๐ ุญู ุงููุดุงูู

### ุงููุดููุฉ 1: ุงูููุฏูู ูุง ูุณุฌู ุงูุฃุญุฏุงุซ

**ุงูุญู**:
1. ุชุฃูุฏ ูู ุฃู ุงูููุฏูู ูุซุจุช: `Apps โ auto_webhook โ Installed`
2. ุชุญูู ูู ุงูุณุฌูุงุช: `tail -f /var/log/odoo/odoo18.log`
3. ุชุฃูุฏ ูู ุฃู ุงููููุฐุฌ ููุฌูุฏ ูู `list_model.py`

### ุงููุดููุฉ 2: ุฃุฎุทุงุก ูู ุงูุชุณุฌูู

**ุงูุญู**:
1. ุฑุงุฌุน ุฌุฏูู `webhook.errors` ูู ูุงุฌูุฉ Odoo
2. ุชุญูู ูู ุงูุตูุงุญูุงุช
3. ุฑุงุฌุน ุงูุณุฌูุงุช ููุชูุงุตูู

### ุงููุดููุฉ 3: ุณุฌูุงุช ููุฑุฑุฉ

**ุงูุญู**:
- ุงูููุฏูู ูููุน ุงูุชูุฑุงุฑ ุชููุงุฆูุงู
- ุฅุฐุง ุธูุฑุช ุณุฌูุงุช ููุฑุฑุฉุ ูุฏ ุชููู ูู ูุณุฎุฉ ูุฏููุฉ ูุจู ุงูุชุญุฏูุซ

---

## ๐ ุงูุชุฑุฎูุต

LGPL-3

---

## ๐ค ุงููุคูู

Odoo Zak, Odoo SA

---

## ๐ ุงููููุน

https://www.geniustep.com

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฃุฏุงุก**: ุงูููุฏูู ูุณุฌู ูู ุญุฏุซุ ูุฐุง ูุฏ ูุฒุฏุงุฏ ุญุฌู ุฌุฏูู `update.webhook` ุจุณุฑุนุฉ. ูููุตุญ ุจุชูุธูู ุฏูุฑู.

2. **ุงูุฃูุงู**: ุฌููุน ุงูุณุฌูุงุช ุชููุดุฃ ุจุงุณุชุฎุฏุงู `sudo()` ูุถูุงู ุนุฏู ูุฌูุฏ ูุดุงูู ูู ุงูุตูุงุญูุงุช.

3. **ุงูุชูุฑุงุฑ**: ุงูููุฏูู ูููุน ุงูุชูุฑุงุฑ ุชููุงุฆูุงู ุจุงุณุชุฎุฏุงู ููุฏ ูุฑูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

4. **ุงูุชูุงูู**: ุงูููุฏูู ูุชูุงูู ูุน Odoo 18 ููุท.

---

## ๐ ุงููุฑุงุฌุน

- [ูุณุชูุฏุน GitHub ุงูุฃุตูู](https://github.com/geniustep/odoo-webhook-corp)
- [ูุซุงุฆู Odoo 18](https://www.odoo.com/documentation/18.0/)

---

**ุขุฎุฑ ุชุญุฏูุซ**: ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 1.0.0

