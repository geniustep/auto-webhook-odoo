# Auto Webhook - Enterprise Grade

## ๐ ูุธุฑุฉ ุนุงูุฉ

**Auto Webhook** ูู ูุธุงู ุฅุฏุงุฑุฉ webhooks ูุชูุฏู ููุชูุงูู ูู Odoo 18 ูููุฑ ุชุชุจุน ุชููุงุฆู ูุฌููุน ุงูุชุบููุฑุงุช ูู ุงูููุงุฐุฌ ุงููุญุฏุฏุฉ ูุฅุฑุณุงููุง ุฅูู ููุงุท ููุงูุฉ ุฎุงุฑุฌูุฉ (ูุซู BridgeCore API).

### ุงูุฅุตุฏุงุฑ
- **ุงูุฅุตุฏุงุฑ ุงูุญุงูู**: 2.1.0
- **ูุชูุงูู ูุน**: Odoo 18
- **ุงูุชุฑุฎูุต**: LGPL-3
- **ุงููุทูุฑ**: Odoo Zak, Geniustep

---

## โจ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### ๐ฏ ุงูุชุชุจุน ุงูุชููุงุฆู
- **ุชุชุจุน ูู ุงูููุช ุงููุนูู**: ุชุชุจุน ุชููุงุฆู ูุนูููุงุช ุงูุฅูุดุงุกุ ุงูุชุนุฏููุ ูุงูุญุฐู
- **13 ูููุฐุฌ ููุชุชุจุน**: sale.order, product.template, res.partner, account.move, stock.move, account.payment, crm.lead ูุบูุฑูุง
- **ูุดู ุฐูู**: ูุณุชุฎุฏู ORM hooks ุจุฏูู ุงูุญุงุฌุฉ ุฅูู database triggers
- **ูุนุงูุฌุฉ ุขููุฉ**: ุงุณุชุฎุฏุงู savepoints ู sudo() ูุชุฌูุจ ุชุฃุซูุฑ webhook ุนูู ุงูุนูููุงุช ุงูุฑุฆูุณูุฉ

### โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงููุฑูุฉ
- **ุฅุนุฏุงุฏุงุช ููู ูููุฐุฌ**: ุฅุนุฏุงุฏุงุช ูููุตูุฉ ููู ูููุฐุฌ ูุน ุฃููููุงุช ููุณุชููุงุช
- **ุชุตููู ุงูุฃุญุฏุงุซ**: ุชุตููู ุงูุฃุญุฏุงุซ ุญุณุจ ุงูููุน (create/write/unlink)
- **ุชุตููุฉ ุงูุญููู**: ุฅููุงููุฉ ุชุตููุฉ ุงูุญููู ุงููุฑุณูุฉ ูู payload

### ๐ ุงููุดุชุฑููู ุงููุชุนุฏุฏูู
- **ููุงุท ููุงูุฉ ูุชุนุฏุฏุฉ**: ุฏุนู ุนุฏุฉ ููุงุท ููุงูุฉ webhook
- **ุฃููุงุน ุงููุตุงุฏูุฉ**: Bearer Token, API Key, Basic Auth
- **Rate Limiting**: ุงูุชุญูู ูู ูุนุฏู ุงูุทูุจุงุช ููู ูุดุชุฑู
- **ุงุฎุชุจุงุฑ ุงูุงุชุตุงู**: ุฅููุงููุฉ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ูุจู ุงูุฅุฑุณุงู

### ๐ ูุธุงู ุงูููุงูุจ
- **ููุงูุจ Jinja2**: ููุงูุจ ูุงุจูุฉ ููุชุฎุตูุต ุจุงุณุชุฎุฏุงู Jinja2
- **ุชูุณูู JSON**: ุชูุณูู JSON ููุธู ููุธูู
- **ุญููู ูุฎุตุตุฉ**: ุฅููุงููุฉ ุชุถููู ุฃู ุงุณุชุจุนุงุฏ ุญููู ูุญุฏุฏุฉ

### ๐ ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- **Exponential Backoff**: ุฅุนุงุฏุฉ ูุญุงููุฉ ุฐููุฉ ูุน ุฒูุงุฏุฉ ุชุฏุฑูุฌูุฉ ูู ุงูููุช
- **Dead Letter Queue**: ูุงุฆูุฉ ููุฃุญุฏุงุซ ุงููุงุดูุฉ ุจุดูู ุฏุงุฆู
- **ุฅุนุฏุงุฏุงุช ูุงุจูุฉ ููุชุฎุตูุต**: ุนุฏุฏ ุงููุญุงููุงุช ูุงูููุงุตู ุงูุฒูููุฉ

### ๐ ุณุฌู ุงูุชุฏููู
- **ุณุฌู ูุงูู**: ุชุชุจุน ุฌููุน ุฃูุดุทุฉ webhook
- **ูุนูููุงุช ุงูุงุณุชุฌุงุจุฉ**: ุญูุธ ููุฏ ุงูุงุณุชุฌุงุจุฉ ูููุช ุงููุนุงูุฌุฉ
- **ุชุณุฌูู ุงูุฃุฎุทุงุก**: ุชุณุฌูู ููุตู ูุฌููุน ุงูุฃุฎุทุงุก

### ๐ ูุนุงูุฌุฉ ุงูุฏููุนุงุช
- **ูุนุงูุฌุฉ ุฏููุนูุฉ ุงุฎุชูุงุฑูุฉ**: ูุณููุงุฑูููุงุช ุงูุญุฌู ุงููุจูุฑ
- **ุชุญุณูู ุงูุฃุฏุงุก**: ุชูููู ุนุฏุฏ ุงูุทูุจุงุช HTTP
- **ุฅุนุฏุงุฏุงุช ูุงุจูุฉ ููุชุฎุตูุต**: ุญุฌู ุงูุฏูุนุฉ ูุงูููุช ุงููุณุชุบุฑู

### ๐ ุชูุงูู BridgeCore
- **ุชูุงูู ุณูุณ**: ุชูุงูู ูุจุงุดุฑ ูุน BridgeCore API
- **URL ูุฎุตุต**: ุฅููุงููุฉ ุชุญุฏูุฏ BridgeCore URL ููู ุญุฏุซ
- **ุฏุนู Flutter**: ูุตูู ููุนูู ูุน ุชุทุจููุงุช Flutter

### ๐ Dual-Write System
- **ูุธุงู Dual-Write**: ูุชุงุจุฉ ูู `webhook.event` ู `update.webhook` ูุนุงู
- **Pull-based API**: BridgeCore ููููู ุณุญุจ ุงูุฃุญุฏุงุซ ุนุจุฑ API
- **ุฃุฏุงุก ูุญุณูู**: ูุชุงุจุฉ ุณุฑูุนุฉ ูู `update.webhook` ุจุฏูู ุชุฃุซูุฑ ุนูู ุงูุนูููุงุช ุงูุฑุฆูุณูุฉ
- **ุฃุฑุดูุฉ ุชููุงุฆูุฉ**: ุชูุธูู ุงูุฃุญุฏุงุซ ุงููุฏููุฉ ุชููุงุฆูุงู

### ๐ค User Sync State
- **ุชุชุจุน ุญุงูุฉ ุงููุฒุงููุฉ**: ุชุชุจุน ุญุงูุฉ ุงููุฒุงููุฉ ููู ูุณุชุฎุฏู/ุฌูุงุฒ
- **ุฏุนู ูุชุนุฏุฏ ุงูุฃุฌูุฒุฉ**: ุฏุนู ุนุฏุฉ ุฃุฌูุฒุฉ ูููุณ ุงููุณุชุฎุฏู
- **ุฃููุงุน ุงูุชุทุจููุงุช**: ุฏุนู Sales, Delivery, Warehouse, Manager, Mobile Apps
- **ุฅุญุตุงุฆูุงุช**: ุฅุญุตุงุฆูุงุช ุดุงููุฉ ุนู ุนูููุงุช ุงููุฒุงููุฉ

---

## ๐ฆ ุงููุชุทูุจุงุช

### ูุชุทูุจุงุช ุงููุธุงู
- **Odoo**: 16.0, 17.0, ุฃู 18.0
- **Python**: 3.8 ุฃู ุฃุญุฏุซ
- **PostgreSQL**: 12 ุฃู ุฃุญุฏุซ

### ุงูููุชุจุงุช ุงููุทููุจุฉ
```bash
pip install requests jinja2
```

### ุงูููุฏููุงุช ุงููุทููุจุฉ
- `base`
- `mail`
- `sale`
- `product`
- `account`
- `purchase`
- `stock`
- `hr_expense`
- `hr`

---

## ๐ง ุงูุชุซุจูุช

### ุงูุทุฑููุฉ 1: ูู GitHub

```bash
cd /opt/odoo18/custom_models
git clone https://github.com/geniustep/auto-webhook-odoo.git auto_webhook
cd auto_webhook
pip install requests jinja2
```

### ุงูุทุฑููุฉ 2: ุงููุณุฎ ุงููุฏูู

```bash
# ูุณุฎ ุงูููุฏูู ุฅูู ูุฌูุฏ addons
cp -r auto_webhook /opt/odoo18/custom_models/

# ุชุซุจูุช ุงูููุชุจุงุช
cd /opt/odoo18
source venv/bin/activate
pip install requests jinja2
```

### ุชุซุจูุช ุงูููุฏูู ูู Odoo

#### ูู ูุงุฌูุฉ Odoo:
1. ุงูุชุญ Odoo: `http://localhost:8069`
2. ุงุฐูุจ ุฅูู: **Apps**
3. ุงุถุบุท ุนูู **Update Apps List**
4. ุงุจุญุซ ุนู: **Auto Webhook - Enterprise Grade**
5. ุงุถุบุท **Install**

#### ูู ุณุทุฑ ุงูุฃูุงูุฑ:
```bash
sudo -u odoo18 bash -c "cd /opt/odoo18 && source venv/bin/activate && python3 odoo/odoo-bin -c /etc/odoo18.conf -d your_database -i auto_webhook --stop-after-init --no-http"
```

---

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### โก ุงูุฅุนุฏุงุฏ ุงูุชููุงุฆู

**ุนูุฏ ุชุซุจูุช ุงูููุฏููุ ูุชู ุฅุนุฏุงุฏ ูู ุดูุก ุชููุงุฆูุงู:**

โ **Subscriber ุงูุชุฑุงุถู**:
- ุงูุงุณู: BridgeCore Default Endpoint
- URL: `https://api.bridgecore.ma/webhook`
- ุงูุญุงูุฉ: ููุนูู ุชููุงุฆูุงู (Enabled = True)

โ **9 Webhook Configs ููุนููุฉ ุชููุงุฆูุงู**:
- Sale Orders (High Priority)
- Purchase Orders (High Priority)
- Invoices/Account Moves (High Priority)
- Account Payments (High Priority)
- CRM Leads (High Priority)
- Stock Picking (Medium Priority)
- Stock Moves (Medium Priority)
- Customers & Partners (Medium Priority)
- Products (Low Priority)

โ **ุฌููุน Configs ูุฑุจูุทุฉ ุจู Subscriber ุชููุงุฆูุงู**

**ุงููุชูุฌุฉ**: Webhook tracking ูุนูู ูุจุงุดุฑุฉ ุจุนุฏ ุงูุชุซุจูุช ุจุฏูู ุฅุนุฏุงุฏ ูุฏูู!

---

### ๐ ููู ูุนูู ุงููุธุงู

1. **ุนูุฏ ุงูุชุนุฏูู ูู ููุฏูู** (create/write/unlink):
   - ูุชู ุฅูุดุงุก webhook event ุจุญุงูุฉ `PENDING`
   - ุงูุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ: `pending` (ููุณ `sent`)

2. **Cron Job ูุนูู ูู ุฏูููุฉ**:
   - ุงุณู Cron: "Webhook: Process Pending Events"
   - ูุจุญุซ ุนู ุฌููุน ุงูุฃุญุฏุงุซ ุจุญุงูุฉ `pending`
   - ูุฑุณููุง ุฅูู Subscriber endpoint

3. **ุจุนุฏ ุฏูุงุฆู**:
   - Event ููุชูู: `PENDING` โ `PROCESSING` โ `SENT`
   - ุงูููุช ุงูุทุจูุนู: 1-60 ุซุงููุฉ (ุญุณุจ ููุช Cron Job)

---

### ๐ ุญุงูุงุช Webhook Events

| ุงูุญุงูุฉ | ุงููุนูู | ุงูููุช ุงููุชููุน |
|--------|--------|---------------|
| **PENDING** โณ | ูู ุงูุชุธุงุฑ ุงููุนุงูุฌุฉ | ุงูุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ ุนูุฏ ุงูุฅูุดุงุก |
| **PROCESSING** ๐ | ููุฏ ุงูุฅุฑุณุงู | ุฃุซูุงุก HTTP request |
| **SENT** โ | ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ | ุจุนุฏ ูุฌุงุญ HTTP request |
| **FAILED** โ | ูุดู (ูุงุจู ููุฅุนุงุฏุฉ) | ุนูุฏ ูุดู HTTP request |
| **DEAD** ๐ | ูุดู ููุงุฆู | ุจุนุฏ ุชุฌุงูุฒ max_retries |

**ููุงุญุธุฉ**: ูู ุงูุทุจูุนู ุฃู ุชุฑู event ุจุญุงูุฉ `PENDING` ุซู ูุตุจุญ `SENT` ุจุนุฏ ุฏูุงุฆู. ูุฐุง ูุนูู ุฃู Cron Job ูุนูู ุจุดูู ุตุญูุญ.

---

### ๐ ุฃูู ูุชู ุงูุฅุฑุณุงูุ

**ูุชู ุงูุฅุฑุณุงู ุฅูู**: `endpoint_url` ุงูุฎุงุต ุจู **Subscriber**

**ุงูุงูุชุฑุงุถู**: `https://api.bridgecore.ma/webhook`

**ุงูุทุฑููุฉ**: HTTP POST request

**ูุชู**: ุจูุงุณุทุฉ Cron Job ูู ุฏูููุฉ ููุฃุญุฏุงุซ ุงููุนููุฉ (pending)

---

### 1. ุชุฎุตูุต Subscriber (ุงุฎุชูุงุฑู)

**ุงููุณุงุฑ**: `Webhooks โ Configuration โ Subscribers`

ููููู:
- ุชุนุฏูู URL ุงูุงูุชุฑุงุถู
- ุฅุถุงูุฉ Auth Token ุฅุฐุง ูุฒู ุงูุฃูุฑ
- ุฅุถุงูุฉ Subscribers ุฅุถุงููุฉ

**ุงุฎุชุจุงุฑ ุงูุงุชุตุงู**:
- ุงุถุบุท ุนูู **Test Connection** ููุชุญูู ูู ุงูุงุชุตุงู

### 2. ุชุฎุตูุต Webhook Configs (ุงุฎุชูุงุฑู)

**ุงููุณุงุฑ**: `Webhooks โ Configuration โ Webhook Configs`

ููููู:
- ุชุนุฏูู ุงูุฃููููุงุช (High/Medium/Low)
- ุชุบููุฑ ุฃููุงุน ุงูุฃุญุฏุงุซ (Create/Write/Unlink)
- ุฅุถุงูุฉ Subscribers ุฅุถุงููุฉ

### 3. ุนุฑุถ ุงูุฃุญุฏุงุซ

**ุงููุณุงุฑ**: `Webhooks โ Dashboard โ All Events`

ููููู ุนุฑุถ:
- ุฌููุน ุงูุฃุญุฏุงุซ ุงูููุฑุณูุฉ
- ุงูุฃุญุฏุงุซ ุงููุนููุฉ
- ุงูุฃุญุฏุงุซ ุงููุงุดูุฉ
- ุงูุฃุญุฏุงุซ ูู Dead Letter Queue

---

## ๐ ุงูููุงุฐุฌ ุงูููุชุชุจุนุฉ

ุงูููุฏูู ูุชุชุจุน ุงูุชุบููุฑุงุช ูู **13 ูููุฐุฌ** ุงูุชุฑุงุถูุงู:

### ุงูููุงุฐุฌ ุงูุฃุณุงุณูุฉ (10 ููุงุฐุฌ):

| # | ุงููููุฐุฌ | ุงููุตู | ุงูุญุงูุฉ |
|---|---------|-------|--------|
| 1 | `sale.order` | ุทูุจุงุช ุงููุจูุนุงุช | โ ููุนู |
| 2 | `product.template` | ููุงูุจ ุงูููุชุฌุงุช | โ ููุนู |
| 3 | `product.category` | ูุฆุงุช ุงูููุชุฌุงุช | โ ููุนู |
| 4 | `res.partner` | ุงูุนููุงุก ูุงูููุฑุฏูู | โ ููุนู |
| 5 | `account.move` | ุงูููุงุชูุฑ ูุงููููุฏ | โ ููุนู |
| 6 | `account.journal` | ุฏูุงุชุฑ ุงูููููุฉ | โ ููุนู |
| 7 | `hr.expense` | ูุตุฑููุงุช ุงูููุธููู | โ ููุนู |
| 8 | `stock.picking` | ุนูููุงุช ุงูููู | โ ููุนู |
| 9 | `purchase.order` | ุทูุจุงุช ุงูุดุฑุงุก | โ ููุนู |
| 10 | `hr.employee` | ุงูููุธููู | โ ููุนู |

### ุงูููุงุฐุฌ ุงูุฅุถุงููุฉ (3 ููุงุฐุฌ):

| # | ุงููููุฐุฌ | ุงููุตู | ุงูุญุงูุฉ |
|---|---------|-------|--------|
| 11 | `stock.move` | ุญุฑูุงุช ุงููุฎุฒูู | โ ููุนู |
| 12 | `account.payment` | ุงููุฏููุนุงุช | โ ููุนู |
| 13 | `crm.lead` | ุงููุฑุต ุงูุชุฌุงุฑูุฉ | โ ููุนู |

### ุฅุถุงูุฉ ููุงุฐุฌ ุฌุฏูุฏุฉ

ูุฅุถุงูุฉ ูููุฐุฌ ุฌุฏูุฏ ููุชุชุจุน:

1. ุงูุชุญ `/opt/odoo18/custom_models/auto_webhook/models/list_model.py`
2. ุฃุถู ุงูููุงุณ ุงูุฌุฏูุฏ:

```python
class YourModel(models.Model):
    _name = 'your.model'
    _inherit = ['your.model', 'webhook.mixin']
```

3. ุฃุนุฏ ุชุดุบูู Odoo ุฃู ุญุฏุซ ุงูููุฏูู:
```bash
sudo -u odoo18 bash -c "cd /opt/odoo18 && source venv/bin/activate && python3 odoo/odoo-bin -c /etc/odoo18.conf -d your_db -u auto_webhook --stop-after-init --no-http"
```

---

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงููุชูุฏูุฉ

### ุฅุนุฏุงุฏุงุช ุงููุดุชุฑู (Subscriber)

#### ุงููุตุงุฏูุฉ (Authentication)

**Bearer Token**:
```
Auth Type: Bearer Token
Auth Token: your-bearer-token-here
```

**API Key**:
```
Auth Type: API Key
API Key: your-api-key-here
API Key Header: X-API-Key (ุงุฎุชูุงุฑู)
```

**Basic Auth**:
```
Auth Type: Basic Auth
Auth Token: base64(username:password)
```

#### Rate Limiting

```
Rate Limit: 100 (ุทูุจุงุช ูู ุงูุฏูููุฉ)
Rate Limit Window: 60 (ุซุงููุฉ)
```

#### Retry Settings

```
Retry Enabled: โ
Max Retries: 3
```

### ุฅุนุฏุงุฏุงุช Webhook Config

#### ุชุตููุฉ ุงูุญููู

ููููู ุชุญุฏูุฏ ุงูุญููู ุงููุฑุงุฏ ุชุถููููุง ุฃู ุงุณุชุจุนุงุฏูุง:

```
Filtered Fields: name, amount_total, partner_id
```

#### ูุนุงูุฌุฉ ุงูุฏููุนุงุช

```
Batch Enabled: โ
Batch Size: 50 (ุฃุญุฏุงุซ ูู ุงูุฏูุนุฉ)
Batch Timeout: 30 (ุซุงููุฉ)
```

#### ุงูููุงูุจ

ููููู ุงุณุชุฎุฏุงู ููุงูุจ Jinja2 ูุฎุตุตุฉ:

```jinja2
{
    "model": "{{ model }}",
    "record_id": {{ record_id }},
    "event": "{{ event }}",
    "data": {
        "name": "{{ name }}",
        "amount": {{ amount_total }}
    }
}
```

---

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุชุชุจุน ุทูุจ ูุจูุนุงุช ุฌุฏูุฏ

```python
# ุนูุฏ ุฅูุดุงุก ุทูุจ ูุจูุนุงุช ุฌุฏูุฏ
sale_order = self.env['sale.order'].create({
    'partner_id': 1,
    'order_line': [(0, 0, {'product_id': 1, 'product_uom_qty': 10})]
})

# ูุชู ุชููุงุฆูุงู:
# 1. ุฅูุดุงุก webhook event ูู ุฌุฏูู webhook_event
# 2. ุฅุฑุณุงู webhook ุฅูู ุฌููุน ุงููุดุชุฑููู ุงูููุนูููู
# 3. ุชุณุฌูู ุงููุชูุฌุฉ ูู webhook_audit
```

### ูุซุงู 2: ุชุชุจุน ุชุนุฏูู ููุชุฌ

```python
# ุนูุฏ ุชุนุฏูู ููุชุฌ
product = self.env['product.template'].browse(1)
product.write({'name': 'ุงุณู ุฌุฏูุฏ', 'list_price': 100})

# ูุชู ุชููุงุฆูุงู:
# 1. ุฅูุดุงุก webhook event ูุน changed_fields
# 2. ุฅุฑุณุงู webhook ูุน ุงูุญููู ุงููุชุบูุฑุฉ ููุท
```

### ูุซุงู 3: ุชุชุจุน ุญุฐู ุนููู

```python
# ุนูุฏ ุญุฐู ุนููู
partner = self.env['res.partner'].browse(1)
partner.unlink()

# ูุชู ุชููุงุฆูุงู:
# 1. ุฅูุดุงุก webhook event ูู ููุน 'unlink'
# 2. ุฅุฑุณุงู webhook ูุน ุจูุงูุงุช ุงูุณุฌู ุงููุญุฐูู
```

### ูุซุงู 4: ุฅุนุงุฏุฉ ูุญุงููุฉ ูุฏููุฉ

```python
# ูู ูุงุฌูุฉ Odoo:
# Webhooks โ Dashboard โ All Events
# ุงุฎุชุฑ ุญุฏุซ ูุงุดู โ Retry Now

# ุฃู ูู Python:
event = self.env['webhook.event'].browse(1)
event.action_retry_now()
```

---

## ๐ API ูุงููุงุฌูุงุช

### ุงูููุงุฐุฌ (Models)

#### webhook.event
ุงููููุฐุฌ ุงูุฑุฆูุณู ูุชุฎุฒูู ุงูุฃุญุฏุงุซ:

```python
event = self.env['webhook.event'].create({
    'model': 'sale.order',
    'record_id': 123,
    'event': 'create',
    'priority': 'high',
    'subscriber_id': 1,
    'payload': {'name': 'SO001', 'amount': 1000}
})
```

#### webhook.config
ุฅุนุฏุงุฏุงุช webhook ููู ูููุฐุฌ:

```python
config = self.env['webhook.config'].get_config_for_model('sale.order')
if config and config.enabled:
    # ูุนุงูุฌุฉ webhook
```

#### update.webhook
- **ุงููุตู**: ุฌุฏูู ูุชุฎุฒูู ุฌููุน ุงูุฃุญุฏุงุซ (Pull-based)
- **ุงูุงุณุชุฎุฏุงู**: BridgeCore ููููู ุณุญุจ ุงูุฃุญุฏุงุซ ูู ููุง
- **ุงูุญููู ุงูุฑุฆูุณูุฉ**: `model`, `record_id`, `event`, `payload`, `is_processed`, `is_archived`
- **API**: `/api/v1/webhooks/events` (Pull-based)

#### user.sync.state
- **ุงููุตู**: ุชุชุจุน ุญุงูุฉ ุงููุฒุงููุฉ ููู ูุณุชุฎุฏู/ุฌูุงุฒ
- **ุงูุงุณุชุฎุฏุงู**: BridgeCore Smart Sync
- **ุงูุญููู ุงูุฑุฆูุณูุฉ**: `user_id`, `device_id`, `app_type`, `last_event_id`, `last_sync_time`, `sync_count`
- **Methods**: `get_or_create_state()`, `update_sync_state()`, `get_sync_statistics()`

#### webhook.subscriber
ุงููุดุชุฑููู (ููุงุท ุงูููุงูุฉ):

```python
subscriber = self.env['webhook.subscriber'].browse(1)
subscriber.action_test_connection()
```

### ุงูุทุฑู (Methods)

#### ุฅูุดุงุก ุญุฏุซ ูุฏููุงู

```python
self.env['webhook.event'].create_event(
    model_name='sale.order',
    record_id=123,
    event_type='create',
    config=config,
    subscriber=subscriber
)
```

#### ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ ุงููุนููุฉ

```python
self.env['webhook.event'].process_pending_events(limit=100)
```

#### ูุนุงูุฌุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ

```python
self.env['webhook.event'].process_retries()
```

---

## ๐๏ธ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ

#### webhook_event
ุฌุฏูู ุงูุฃุญุฏุงุซ ุงูุฑุฆูุณู:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|-------|
| `model` | Char | ุงุณู ุงููููุฐุฌ |
| `record_id` | Integer | ุฑูู ุงูุณุฌู |
| `event` | Selection | ููุน ุงูุญุฏุซ (create/write/unlink) |
| `status` | Selection | ุงูุญุงูุฉ (pending/processing/sent/failed/dead) |
| `priority` | Selection | ุงูุฃููููุฉ (high/medium/low) |
| `payload` | Text | JSON payload |
| `timestamp` | Datetime | ููุช ุงูุญุฏุซ |
| `retry_count` | Integer | ุนุฏุฏ ุงููุญุงููุงุช |
| `error_message` | Text | ุฑุณุงูุฉ ุงูุฎุทุฃ |

#### webhook_config
ุฅุนุฏุงุฏุงุช webhook:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|-------|
| `name` | Char | ุงุณู ุงูุฅุนุฏุงุฏ |
| `model_id` | Many2one | ุงููููุฐุฌ |
| `events` | Selection | ุฃููุงุน ุงูุฃุญุฏุงุซ |
| `enabled` | Boolean | ููุนูู |
| `priority` | Selection | ุงูุฃููููุฉ |
| `batch_enabled` | Boolean | ูุนุงูุฌุฉ ุฏููุนูุฉ |

#### webhook_subscriber
ุงููุดุชุฑููู:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|-------|
| `name` | Char | ุงุณู ุงููุดุชุฑู |
| `endpoint_url` | Char | URL ููุทุฉ ุงูููุงูุฉ |
| `auth_type` | Selection | ููุน ุงููุตุงุฏูุฉ |
| `auth_token` | Char | Token ุงููุตุงุฏูุฉ |
| `enabled` | Boolean | ููุนูู |
| `rate_limit` | Integer | ุญุฏ ุงููุนุฏู |

### ุงูุฌุฏุงูู ุงูุฅุถุงููุฉ

- `webhook_template` - ููุงูุจ Payload
- `webhook_retry` - ูุนูููุงุช ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- `webhook_audit` - ุณุฌู ุงูุชุฏููู
- `update_webhook` - ููุชูุงูู ูุน ุงูุฅุตุฏุงุฑ ุงููุฏูู

---

## ๐ Cron Jobs

ุงูููุฏูู ูุญุชูู ุนูู 4 ูุธุงุฆู Cron ุชููุงุฆูุฉ:

### 1. Process Pending Events โก (ุงูุฃูู)
- **ุงูุชูุฑุงุฑ**: ูู ุฏูููุฉ
- **ุงููุธููุฉ**: ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ ุงููุนููุฉ (pending) ูุฅุฑุณุงููุง
- **ุงูุญุฏ**: 100 ุญุฏุซ ูู ุงููุฑุฉ
- **ููู ูุนูู**:
  1. ูุจุญุซ ุนู ุฌููุน ุงูุฃุญุฏุงุซ ุจุญุงูุฉ `pending`
  2. ูุฑุณู ูู event ุฅูู Subscriber endpoint
  3. ูุบูุฑ ุงูุญุงูุฉ: `pending` โ `processing` โ `sent`

**ููุงุญุธุฉ**: ูุฐุง ูู Cron Job ุงูุฑุฆูุณู ุงูุฐู ูุฑุณู ุงูุฃุญุฏุงุซ. ุชุฃูุฏ ูู ุฃูู ููุนูู!

### 2. Retry Failed Events
- **ุงูุชูุฑุงุฑ**: ูู ุฏูููุฉ
- **ุงููุธููุฉ**: ุฅุนุงุฏุฉ ูุญุงููุฉ ุงูุฃุญุฏุงุซ ุงููุงุดูุฉ
- **ุงูุญุฏ ุงูุฃูุตู**: ุญุณุจ ุฅุนุฏุงุฏุงุช ุงููุดุชุฑู (ุงูุงูุชุฑุงุถู: 5 ูุญุงููุงุช)
- **Exponential Backoff**: 
  - ุงููุญุงููุฉ 1: ุจุนุฏ 60 ุซุงููุฉ
  - ุงููุญุงููุฉ 2: ุจุนุฏ 120 ุซุงููุฉ (2 ุฏูููุฉ)
  - ุงููุญุงููุฉ 3: ุจุนุฏ 240 ุซุงููุฉ (4 ุฏูุงุฆู)
  - ุงููุญุงููุฉ 4: ุจุนุฏ 480 ุซุงููุฉ (8 ุฏูุงุฆู)
  - ุงููุญุงููุฉ 5: ุจุนุฏ 960 ุซุงููุฉ (16 ุฏูููุฉ)

### 3. Cleanup Old Events
- **ุงูุชูุฑุงุฑ**: ููููุงู
- **ุงููุธููุฉ**: ุญุฐู ุงูุฃุญุฏุงุซ ุงููุฏููุฉ (ุฃูุซุฑ ูู 90 ููู)

### 4. Cleanup Old Audit Logs
- **ุงูุชูุฑุงุฑ**: ุฃุณุจูุนูุงู
- **ุงููุธููุฉ**: ุญุฐู ุณุฌูุงุช ุงูุชุฏููู ุงููุฏููุฉ (ุฃูุซุฑ ูู 180 ููู)

---

## ๐๏ธ ุงูุตูุงูุฉ ูุงูุชูุธูู

### ุชูุธูู ุงูุฃุญุฏุงุซ ุงููุฏููุฉ

```python
# ุชูุธูู ุงูุฃุญุฏุงุซ ุงูุฃูุฏู ูู 90 ููู
self.env['webhook.event'].cleanup_old_events(days=90)

# ุชูุธูู ุณุฌูุงุช ุงูุชุฏููู ุงูุฃูุฏู ูู 180 ููู
self.env['webhook_audit'].cleanup_old_logs(days=180)
```

### ุฅุญุตุงุฆูุงุช

```python
# ุนุฏุฏ ุงูุฃุญุฏุงุซ ุงููุนููุฉ
pending = self.env['webhook.event'].search_count([('status', '=', 'pending')])

# ุนุฏุฏ ุงูุฃุญุฏุงุซ ุงููุงุดูุฉ
failed = self.env['webhook.event'].search_count([('status', '=', 'failed')])

# ูุนุฏู ุงููุฌุงุญ
total = self.env['webhook.event'].search_count([])
sent = self.env['webhook.event'].search_count([('status', '=', 'sent')])
success_rate = (sent / total) * 100 if total > 0 else 0
```

---

## ๐ ุญู ุงููุดุงูู

### ุงููุดููุฉ 0: ุฎุทุฃ ูู ุงูุตูุงุญูุงุช "Vous n'รชtes pas autorisรฉ"

**ุงูุฃุนุฑุงุถ**: ุฎุทุฃ "Vous n'รชtes pas autorisรฉ ร accรฉder aux enregistrements" ุนูุฏ ูุญุงููุฉ ุงูุชุนุฏูู

**ุงูุญู**:
1. ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏู ูููู ุงูุตูุงุญูุงุช ุงููุทููุจุฉ:
   - Product Creation (ููููุชุฌุงุช)
   - Sales Manager (ูุทูุจุงุช ุงููุจูุนุงุช)
   - Stock Manager (ูููุฎุฒูู)
   - Purchase Manager (ูุทูุจุงุช ุงูุดุฑุงุก)
   - Account Manager (ููููุงุชูุฑ)

2. ูููู ุฅุถุงูุฉ ุงูุตูุงุญูุงุช ูู:
   - `Settings โ Users & Companies โ Users`
   - ุงุฎุชุฑ ุงููุณุชุฎุฏู โ `Access Rights` โ ุฃุถู ุงููุฌููุนุงุช ุงููุทููุจุฉ

3. ุจุนุฏ ุฅุถุงูุฉ ุงูุตูุงุญูุงุช:
   - ุณุฌูู ุงูุฎุฑูุฌ ุซู ุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู
   - ุญุฏูุซ ุงูุตูุญุฉ (Ctrl+F5)

### ุงููุดููุฉ 1: ุงูููุฏูู ูุง ูุณุฌู ุงูุฃุญุฏุงุซ

**ุงูุฃุนุฑุงุถ**: ูุง ูุชู ุฅูุดุงุก webhook events ุนูุฏ ุงูุชุบููุฑุงุช

**ุงูุญููู**:
1. ุชุฃูุฏ ูู ุฃู ุงูููุฏูู ูุซุจุช: `Apps โ auto_webhook โ Installed`
2. ุชุญูู ูู ูุฌูุฏ webhook config ููุนูู ูููููุฐุฌ
3. ุชุญูู ูู ุงูุณุฌูุงุช: `tail -f /var/log/odoo/odoo18.log`
4. ุชุฃูุฏ ูู ุฃู ุงููููุฐุฌ ููุฌูุฏ ูู `list_model.py`

### ุงููุดููุฉ 2: ุงูุฃุญุฏุงุซ ูุง ุชูุฑุณู

**ุงูุฃุนุฑุงุถ**: ูุชู ุฅูุดุงุก events ููู ูุง ุชูุฑุณู (ุชุจูู ุจุญุงูุฉ PENDING)

**ุงูุญููู**:
1. **ุชุญูู ูู Cron Job**: `Settings โ Technical โ Automation โ Scheduled Actions`
   - ุงุจุญุซ ุนู "Webhook: Process Pending Events"
   - ุชุฃูุฏ ูู ุฃูู ููุนูู (Active = True)
   - ุชุญูู ูู ุขุฎุฑ ุชุดุบูู (Last Run)
2. ุชุญูู ูู ูุฌูุฏ ูุดุชุฑููู ููุนูููู
3. ุชุญูู ูู ุตุญุฉ URL ููุทุฉ ุงูููุงูุฉ
4. ุงุฎุชุจุฑ ุงูุงุชุตุงู: `Subscribers โ Test Connection`
5. ุฑุงุฌุน ุฌุฏูู `webhook_audit` ููุฃุฎุทุงุก
6. ุชุญูู ูู ุงูุณุฌูุงุช: `tail -f /var/log/odoo/odoo18.log | grep webhook`

### ุงููุดููุฉ 3: ุฃุฎุทุงุก ูู ุงููุตุงุฏูุฉ

**ุงูุฃุนุฑุงุถ**: `401 Unauthorized` ุฃู `403 Forbidden`

**ุงูุญููู**:
1. ุชุญูู ูู ุตุญุฉ Token/API Key
2. ุชุญูู ูู ููุน ุงููุตุงุฏูุฉ (Bearer/API Key/Basic)
3. ุชุญูู ูู headers ุงููุทููุจุฉ
4. ุฑุงุฌุน ุณุฌูุงุช webhook_audit

### ุงููุดููุฉ 4: ุฃุฏุงุก ุจุทูุก

**ุงูุฃุนุฑุงุถ**: ุจุทุก ูู ูุนุงูุฌุฉ ุงูุฃุญุฏุงุซ

**ุงูุญููู**:
1. ูุนูู ูุนุงูุฌุฉ ุงูุฏููุนุงุช (Batch Processing)
2. ุฒุฏ ุญุฌู ุงูุฏูุนุฉ (Batch Size)
3. ุฑุงุฌุน Rate Limiting
4. ุชุญูู ูู ููุงุฑุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงููุดููุฉ 5: ุฃุญุฏุงุซ ููุฑุฑุฉ

**ุงูุฃุนุฑุงุถ**: ููุณ ุงูุญุฏุซ ููุฑุณู ุนุฏุฉ ูุฑุงุช

**ุงูุญููู**:
1. ุชุญูู ูู ุฅุนุฏุงุฏุงุช Retry
2. ุฑุงุฌุน webhook_audit ููุชุญูู ูู ุงูุชูุฑุงุฑ
3. ุชุญูู ูู Cron Jobs (ูุฏ ุชููู ููุฑุฑุฉ)

---

## ๐ ุงูุฃุฏุงุก ูุงูุชุญุณูู

### ุฃูุถู ุงูููุงุฑุณุงุช

1. **ุงุณุชุฎุฏู ูุนุงูุฌุฉ ุงูุฏููุนุงุช** ููุฃุญุฌุงู ุงููุจูุฑุฉ
2. **ูุนูู Rate Limiting** ูุชุฌูุจ ุฅุฑูุงู ุงูุฎุงุฏู
3. **ุงุณุชุฎุฏู ุงูุฃููููุงุช** ููุฃุญุฏุงุซ ุงููููุฉ
4. **ูุธู ุงูุฃุญุฏุงุซ ุงููุฏููุฉ** ุฏูุฑูุงู
5. **ุฑุงูุจ webhook_audit** ุจุงูุชุธุงู

### ุงูุชุญุณููุงุช

- **ุงูููุงุฑุณ**: ุงูููุฏูู ููุดุฆ ููุงุฑุณ ูุฑูุจุฉ ุชููุงุฆูุงู
- **ุงูุชุฎุฒูู ุงููุคูุช**: ุงุณุชุฎุฏุงู cache ููู configs
- **ุงููุนุงูุฌุฉ ุบูุฑ ุงููุชุฒุงููุฉ**: ุงูุฃุญุฏุงุซ ูุง ุชุนูู ุงูุนูููุงุช ุงูุฃุณุงุณูุฉ

---

## ๐ ุงูุฃูุงู

### ุงูุตูุงุญูุงุช

- **base.group_user**: ูุฑุงุกุฉ ุงูุฃุญุฏุงุซ
- **base.group_system**: ุฅุฏุงุฑุฉ ูุงููุฉ (configs, subscribers)

### ุฃูุถู ุงูููุงุฑุณุงุช ุงูุฃูููุฉ

1. **ุงุณุชุฎุฏู HTTPS** ูุฌููุน endpoints
2. **ุงุณุชุฎุฏู Bearer Tokens** ุจุฏูุงู ูู API Keys ุนูุฏ ุงูุฅููุงู
3. **ูุนูู SSL Verification**
4. **ุฑุงูุจ webhook_audit** ููุฃูุดุทุฉ ุงููุดุจููุฉ
5. **ุงุณุชุฎุฏู Rate Limiting** ูููุน ุงููุฌูุงุช

---

## ๐ ุงููุฑุงุฌุน ูุงูุฑูุงุจุท

- **ุงููุณุชูุฏุน**: https://github.com/geniustep/auto-webhook-odoo
- **ุงููููุน**: https://www.geniustep.com
- **ูุซุงุฆู Odoo 18**: https://www.odoo.com/documentation/18.0/
- **Jinja2 Documentation**: https://jinja.palletsprojects.com/

---

## ๐ค ุงููุณุงููุฉ

ูุฑุญุจ ุจุงููุณุงููุงุช! ูุฑุฌู:

1. Fork ุงููุณุชูุฏุน
2. ุฅูุดุงุก branch ุฌุฏูุฏ (`git checkout -b feature/amazing-feature`)
3. Commit ุงูุชุบููุฑุงุช (`git commit -m 'Add amazing feature'`)
4. Push ุฅูู branch (`git push origin feature/amazing-feature`)
5. ูุชุญ Pull Request

---

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงููุดุฑูุน ูุฑุฎุต ุชุญุช **LGPL-3 License**.

---

## ๐ฅ ุงููุคูููู

- **Odoo Zak** - ุงููุทูุฑ ุงูุฑุฆูุณู
- **Geniustep** - ุงูุดุฑูุฉ ุงููุทูุฑุฉ

---

## ๐ ุงูุฏุนู

ููุญุตูู ุนูู ุงูุฏุนู:
- **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู**: info@geniustep.com
- **ุงููููุน**: https://www.geniustep.com
- **GitHub Issues**: https://github.com/geniustep/auto-webhook-odoo/issues

---

## ๐ ุณุฌู ุงูุชุบููุฑุงุช (Changelog)

### ุงูุฅุตุฏุงุฑ 2.0.0 (2025-11-16)
- โจ ูุธุงู Enterprise-grade ูุงูู
- โจ ุชูุงูู BridgeCore
- โจ ูุธุงู ุงูููุงูุจ Jinja2
- โจ ุขููุฉ Retry ูุชูุฏูุฉ
- โจ Dead Letter Queue
- โจ Audit Logging ุดุงูู
- โจ Rate Limiting
- โจ Batch Processing
- โจ **ุฅุนุฏุงุฏุงุช ุชููุงุฆูุฉ**: Subscriber ู 6 Configs ููุนููุฉ ุชููุงุฆูุงู ุนูุฏ ุงูุชุซุจูุช
- โจ **ุฑุจุท ุชููุงุฆู**: ุฌููุน Configs ูุฑุจูุทุฉ ุจู Subscriber ุชููุงุฆูุงู
- ๐ ุฅุตูุงุญุงุช ุงูุชูุงูู ูุน Odoo 18

### ุงูุฅุตุฏุงุฑ 1.0.0 (2025-11-15)
- ๐ ุงูุฅุตุฏุงุฑ ุงูุฃููู
- โจ ุชุชุจุน ุชููุงุฆู ูู 10 ููุงุฐุฌ
- โจ ุชุณุฌูู ุงูุฃุญุฏุงุซ ุงูุฃุณุงุณู

---

## ๐ฏ ุฎุงุฑุทุฉ ุงูุทุฑูู

### ุงูููุฒุงุช ุงููุงุฏูุฉ
- [ ] Webhook Signature Verification
- [ ] Webhook Event Filtering Rules
- [ ] Webhook Event Transformation
- [ ] Webhook Dashboard Analytics
- [ ] Webhook Event Replay
- [ ] Webhook Event Export/Import

---

**ุขุฎุฑ ุชุญุฏูุซ**: ููููุจุฑ 2025  
**ุงูุฅุตุฏุงุฑ**: 2.1.0  
**ุงูุญุงูุฉ**: โ Production Ready

---

*Made with โค๏ธ by Geniustep Team*
