<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- ════════════════════════════════════════════════════════════ -->
    <!-- Webhook Rule - Tree View -->
    <!-- ════════════════════════════════════════════════════════════ -->
    
    <record id="view_webhook_rule_tree" model="ir.ui.view">
        <field name="name">webhook.rule.tree</field>
        <field name="model">webhook.rule</field>
        <field name="arch" type="xml">
            <list string="Webhook Rules" decoration-muted="not active" decoration-info="test_mode">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="model_name"/>
                <field name="operation" widget="badge" decoration-info="operation == 'create'" decoration-warning="operation == 'write'" decoration-danger="operation == 'unlink'"/>
                <field name="priority" widget="badge" decoration-danger="priority == 'high'" decoration-warning="priority == 'medium'" decoration-success="priority == 'low'"/>
                <field name="instant_send" widget="boolean_toggle"/>
                <field name="subscriber_ids" widget="many2many_tags"/>
                <field name="event_count"/>
                <field name="last_trigger"/>
                <field name="test_mode" widget="boolean_toggle"/>
                <field name="active" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

    <!-- ════════════════════════════════════════════════════════════ -->
    <!-- Webhook Rule - Form View -->
    <!-- ════════════════════════════════════════════════════════════ -->
    
    <record id="view_webhook_rule_form" model="ir.ui.view">
        <field name="name">webhook.rule.form</field>
        <field name="model">webhook.rule</field>
        <field name="arch" type="xml">
            <form string="Webhook Rule">
                <header>
                    <button name="action_test_rule" type="object" string="Test Rule" class="btn-secondary" icon="fa-flask"/>
                    <button name="action_view_events" type="object" string="View Events" class="btn-secondary" icon="fa-list"/>
                    <button name="action_refresh_cache" type="object" string="Refresh Cache" class="btn-secondary" icon="fa-refresh"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_events" type="object" class="oe_stat_button" icon="fa-list">
                            <field name="event_count" widget="statinfo" string="Events"/>
                        </button>
                    </div>
                    
                    <widget name="web_ribbon" title="Test Mode" bg_color="text-bg-info" invisible="not test_mode"/>
                    <widget name="web_ribbon" title="Inactive" bg_color="text-bg-secondary" invisible="active"/>
                    
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Rule Name..."/>
                        </h1>
                    </div>
                    
                    <group>
                        <group string="Model &amp; Operation">
                            <field name="model_id" options="{'no_create': True, 'no_open': True}"/>
                            <field name="model_name" invisible="1"/>
                            <field name="operation"/>
                            <field name="sequence" groups="base.group_no_one"/>
                        </group>
                        <group string="Priority &amp; Sending">
                            <field name="priority"/>
                            <field name="category"/>
                            <field name="instant_send"/>
                            <field name="test_mode"/>
                            <field name="active"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Subscribers" name="subscribers">
                            <field name="subscriber_ids" widget="many2many_tags" options="{'color_field': 'color'}">
                                <list>
                                    <field name="name"/>
                                    <field name="endpoint_url"/>
                                    <field name="enabled"/>
                                </list>
                            </field>
                            <p class="text-muted">
                                Select webhook endpoints to notify when this rule is triggered.
                            </p>
                        </page>
                        
                        <page string="Filters" name="filters">
                            <group>
                                <group string="Domain Filter">
                                    <field name="domain" widget="domain" options="{'model': 'model_name'}" placeholder="[]"/>
                                    <p class="text-muted">
                                        Filter records using a domain. Only matching records will trigger webhooks.
                                        <br/>Example: <code>[('state', '=', 'sale')]</code>
                                    </p>
                                </group>
                                <group string="Field Tracking">
                                    <field name="tracked_fields" placeholder="field1, field2, field3"/>
                                    <p class="text-muted">
                                        Comma-separated field names. Leave empty to track all fields.
                                        <br/>For write operations, webhook only triggers if these fields change.
                                    </p>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Advanced" name="advanced">
                            <group>
                                <group string="Rate Limiting">
                                    <field name="rate_limit"/>
                                    <field name="debounce_seconds"/>
                                </group>
                                <group string="Template">
                                    <field name="template_id"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Statistics" name="statistics">
                            <group>
                                <group>
                                    <field name="event_count"/>
                                    <field name="last_trigger"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Notes" name="notes">
                            <field name="description" placeholder="Add notes about this rule..."/>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- ════════════════════════════════════════════════════════════ -->
    <!-- Webhook Rule - Search View -->
    <!-- ════════════════════════════════════════════════════════════ -->
    
    <record id="view_webhook_rule_search" model="ir.ui.view">
        <field name="name">webhook.rule.search</field>
        <field name="model">webhook.rule</field>
        <field name="arch" type="xml">
            <search string="Search Webhook Rules">
                <field name="name"/>
                <field name="model_name"/>
                <field name="operation"/>
                <field name="subscriber_ids"/>
                
                <filter name="filter_active" string="Active" domain="[('active', '=', True)]"/>
                <filter name="filter_inactive" string="Inactive" domain="[('active', '=', False)]"/>
                <separator/>
                <filter name="filter_create" string="Create" domain="[('operation', '=', 'create')]"/>
                <filter name="filter_write" string="Write" domain="[('operation', '=', 'write')]"/>
                <filter name="filter_unlink" string="Delete" domain="[('operation', '=', 'unlink')]"/>
                <separator/>
                <filter name="filter_high_priority" string="High Priority" domain="[('priority', '=', 'high')]"/>
                <filter name="filter_instant" string="Instant Send" domain="[('instant_send', '=', True)]"/>
                <filter name="filter_test_mode" string="Test Mode" domain="[('test_mode', '=', True)]"/>
                
                <group expand="0" string="Group By">
                    <filter name="group_model" string="Model" context="{'group_by': 'model_name'}"/>
                    <filter name="group_operation" string="Operation" context="{'group_by': 'operation'}"/>
                    <filter name="group_priority" string="Priority" context="{'group_by': 'priority'}"/>
                    <filter name="group_category" string="Category" context="{'group_by': 'category'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ════════════════════════════════════════════════════════════ -->
    <!-- Webhook Rule - Kanban View -->
    <!-- ════════════════════════════════════════════════════════════ -->
    
    <record id="view_webhook_rule_kanban" model="ir.ui.view">
        <field name="name">webhook.rule.kanban</field>
        <field name="model">webhook.rule</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" default_group_by="model_name">
                <field name="name"/>
                <field name="model_name"/>
                <field name="operation"/>
                <field name="priority"/>
                <field name="active"/>
                <field name="event_count"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="oe_kanban_content">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                    </div>
                                    <span class="badge" t-attf-class="#{record.priority.raw_value == 'high' ? 'text-bg-danger' : record.priority.raw_value == 'medium' ? 'text-bg-warning' : 'text-bg-success'}">
                                        <field name="priority"/>
                                    </span>
                                </div>
                                <div class="o_kanban_record_body">
                                    <span class="badge text-bg-secondary me-1">
                                        <field name="operation"/>
                                    </span>
                                    <span class="text-muted">
                                        <field name="event_count"/> events
                                    </span>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- ════════════════════════════════════════════════════════════ -->
    <!-- Webhook Rule - Action -->
    <!-- ════════════════════════════════════════════════════════════ -->
    
    <record id="action_webhook_rule" model="ir.actions.act_window">
        <field name="name">Webhook Rules</field>
        <field name="res_model">webhook.rule</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="context">{'search_default_filter_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first Webhook Rule
            </p>
            <p>
                Webhook Rules allow you to track changes in any Odoo model
                without writing code. Simply select a model, choose which
                operations to track (create/update/delete), and add subscribers.
            </p>
        </field>
    </record>

    <!-- ════════════════════════════════════════════════════════════ -->
    <!-- Menu Items -->
    <!-- ════════════════════════════════════════════════════════════ -->

    <menuitem id="menu_webhook_rule"
              name="Rules"
              parent="webhook_config_menu"
              action="action_webhook_rule"
              sequence="5"/>

</odoo>

